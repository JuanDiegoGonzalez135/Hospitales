<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hospital - Asistencia Paciente</title>
    <link rel="manifest" href="../../manifest.json">
    
    <link rel="stylesheet" href="../../css/bootstrap.min.css">
    <link rel="stylesheet" href="../../css/navbar.css">
    <link rel="stylesheet" href="../../css/paciente.css">
</head>
<body>
    <div class="container text-center mt-5">
        <header class="mb-5">
            <h1>Sistema de Asistencia Hospitalaria</h1>
            <p class="lead text-muted">Aplicación del Paciente</p>
            <hr>
        </header>
        
        <div id="scan-view" class="view">
            <h2>Paso 1: Vincular Cama</h2>
            <p>Escanee el código QR de su cama para conectar su dispositivo.</p>
            <div id="qr-scanner-wrapper">
                <div id="qr-scanner"></div>
            </div>
            <p class="mt-3 text-danger hidden" id="scan-error-message">
                Error: No se pudo iniciar la cámara o vincular la cama.
            </p>
        </div>

        <div id="help-view" class="view hidden">
            <p class="lead">
                Dispositivo vinculado a la cama:
                <span id="cama-codigo-display" class="fw-bold"></span>.
            </p>
            
            <div id="cooldown-message"
                 class="alert alert-warning p-3 mb-4 hidden">
                Solicitud enviada.
                Espere <span id="countdown" class="fw-bold"></span> segundos.
            </div>
            
            <button id="help-button"
                    class="btn btn-danger w-100 btn-help-large shadow">
                SOLICITAR ASISTENCIA
            </button>
            
            <button id="disconnect-button" onclick="disconnectDevice()"
                    class="btn btn-outline-secondary btn-sm mt-4">
                Desvincular Dispositivo
            </button>
        </div> 
    </div>
    
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script src="./js/pacienteApp.js"></script>    
    <script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            // Asegúrese de que la ruta a sw.js sea correcta
            navigator.serviceWorker
                .register('../../sw.js') 
                .then(reg => console.log('SW registrado', reg))
                .catch(err => console.error('Error SW', err));
        });
    }
    </script>
</body>
</html>